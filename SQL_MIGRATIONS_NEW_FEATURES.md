# SQL Миграции для новых функций

## Инструкция по применению миграций

Выполните следующие SQL скрипты в вашей базе данных Neon PostgreSQL:

### 1. Добавление поля nickname в таблицу ads
```bash
Файл: neon_add_nickname_to_ads.sql
```
Добавляет столбец `nickname` для хранения псевдонима автора в каждой анкете.

### 2. Создание таблицы user_blocks
```bash
Файл: neon_user_blocks.sql
```
Создает таблицу для хранения блокировок пользователей (черный список).

## Автоматическое применение через Vercel

Если у вас настроен Vercel, вы можете выполнить миграции через SQL редактор в панели Neon:

1. Откройте [Neon Console](https://console.neon.tech/)
2. Выберите ваш проект
3. Перейдите в SQL Editor
4. Скопируйте и выполните содержимое каждого файла по очереди

## Проверка применения

После выполнения миграций проверьте:

```sql
-- Проверка столбца nickname
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'ads' AND column_name = 'nickname';

-- Проверка таблицы user_blocks
SELECT * FROM information_schema.tables 
WHERE table_name = 'user_blocks';
```

## Новые функции

После применения миграций станут доступны:

✅ **Обновление никнейма во всех анкетах** - при изменении псевдонима он автоматически обновляется во всех созданных анкетах

✅ **Отображение никнейма в запросах** - в запросах на чат показывается установленный псевдоним отправителя

✅ **Превью текста сообщения** - в запросах показываются первые 80 символов сообщения

✅ **Просмотр анкеты в диалоге** - кнопка "Смотреть" открывает полную информацию об анкете

✅ **Меню с троеточием** - блокировка собеседника и удаление чата

✅ **Блокировка пользователей** - черный список с уведомлением заблокированному

✅ **Удаление чата** - удаление чата для обеих сторон с подтверждением
