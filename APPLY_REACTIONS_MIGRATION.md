# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è —Ä–µ–∞–∫—Ü–∏–π –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è

## –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

–°–∏—Å—Ç–µ–º–∞ —Ä–µ–∞–∫—Ü–∏–π –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —á–∞—Ç–∞—Ö:
- **–î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫** –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ = –±—ã—Å—Ç—Ä–∞—è —Ä–µ–∞–∫—Ü–∏—è ‚ù§Ô∏è
- **–û–¥–∏–Ω–∞—Ä–Ω—ã–π –∫–ª–∏–∫** –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ = –º–µ–Ω—é —Å –≤—ã–±–æ—Ä–æ–º —Ä–µ–∞–∫—Ü–∏–π (‚ù§Ô∏è üëç üòÇ üî• üòç üéâ)
- –†–µ–∞–∫—Ü–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö –≤ –≤–∏–¥–µ –º–∞–ª–µ–Ω—å–∫–∏—Ö badge
- –ü–æ–¥—Å—á—ë—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Ä–µ–∞–∫—Ü–∏–π

## –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–§–∞–π–ª:** `migrations/add_message_reactions.sql`

### –®–∞–≥–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:

1. –û—Ç–∫—Ä–æ–π—Ç–µ Neon Console ‚Üí SQL Editor
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à—É –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `add_message_reactions.sql`
4. –ù–∞–∂–º–∏—Ç–µ **Run** (–í—ã–ø–æ–ª–Ω–∏—Ç—å)

### –ß—Ç–æ —Å–æ–∑–¥–∞—ë—Ç—Å—è:

```sql
CREATE TABLE message_reactions (
    id SERIAL PRIMARY KEY,
    message_id INTEGER NOT NULL,
    user_token VARCHAR(255) NOT NULL,
    emoji VARCHAR(10) NOT NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    CONSTRAINT unique_user_reaction UNIQUE (message_id, user_token)
);
```

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ `unique_user_reaction`** - –æ–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É —Ä–µ–∞–∫—Ü–∏—é –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ (–Ω–æ –º–æ–∂–µ—Ç –µ—ë –º–µ–Ω—è—Ç—å).

### –ò–Ω–¥–µ–∫—Å—ã:
- `idx_reactions_message_id` - –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ —Ä–µ–∞–∫—Ü–∏–π –ø–æ ID —Å–æ–æ–±—â–µ–Ω–∏—è
- `idx_reactions_user_token` - –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ —Ä–µ–∞–∫—Ü–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## API endpoints

### POST /api/reactions
–î–æ–±–∞–≤–∏—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å —Ä–µ–∞–∫—Ü–∏—é –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ

**Request:**
```json
{
  "message_id": 123,
  "emoji": "‚ù§Ô∏è",
  "user_token": "user_token_here"
}
```

**Response:**
```json
{
  "success": true,
  "reactions": [
    { "emoji": "‚ù§Ô∏è", "count": 3 },
    { "emoji": "üëç", "count": 1 }
  ]
}
```

### GET /api/reactions?message_id=123
–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ä–µ–∞–∫—Ü–∏–∏ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ

### DELETE /api/reactions
–£–¥–∞–ª–∏—Ç—å —Å–≤–æ—é —Ä–µ–∞–∫—Ü–∏—é

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏:

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ª—é–±–æ–π –ø—Ä–∏–≤–∞—Ç–Ω—ã–π —á–∞—Ç
2. **–î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫** –Ω–∞ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ - –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è ‚ù§Ô∏è
3. **–û–¥–∏–Ω–∞—Ä–Ω—ã–π –∫–ª–∏–∫** –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ - –¥–æ–ª–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å—Å—è –º–µ–Ω—é —Å 6 —ç–º–æ–¥–∑–∏
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ä–µ–∞–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

## Rollback (–æ—Ç–∫–∞—Ç)

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:

```sql
DROP TABLE IF EXISTS message_reactions;
```

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –†–µ–∞–∫—Ü–∏–∏ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ `message_id` –∏ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è (–Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å CASCADE –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)
- –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É —Ä–µ–∞–∫—Ü–∏—é, –Ω–æ –º–æ–∂–µ—Ç –µ—ë –º–µ–Ω—è—Ç—å
- –†–µ–∞–∫—Ü–∏–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ (JOIN –≤ –∑–∞–ø—Ä–æ—Å–µ)
