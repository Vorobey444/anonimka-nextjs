<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Анонимные знакомства</title>
    <link rel="stylesheet" href="/webapp/style.css?v=5.1">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://telegram.org/js/telegram-widget.js?22"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="/webapp/supabase-client.js?v=3.1"></script>
    <script src="/webapp/supabase-proxy.js?v=1.0"></script>
    <script src="/webapp/local-chat-storage.js?v=1.0"></script>
</head>
<body>
    <!-- Переключатель Premium (показывается на всех страницах) -->
    <div class="premium-toggle" id="premiumToggle">
        <button class="premium-btn active free" id="freeBtn" onclick="showPremiumModal()">FREE</button>
        <button class="premium-btn" id="proBtn" onclick="showPremiumModal()">PRO</button>
    </div>

    <div class="app-container">
        <!-- Экран выбора способа определения локации -->
        <div id="locationChoice" class="screen">
            <div class="header">
                <button class="back-btn" onclick="showMainMenu()">← Назад</button>
                <div class="logo">
                    <div class="neon-icon">🌍</div>
                    <h1>Выберите способ</h1>
                    <p>Как определить вашу локацию?</p>
                </div>
            </div>
            
            <div class="location-choice-container">
                <button class="location-choice-btn auto" onclick="showAutoLocationDetection()">
                    <div class="choice-icon">📍</div>
                    <h3>Определить автоматически</h3>
                    <p>Мы определим ваше местоположение по IP-адресу</p>
                </button>
                
                <button class="location-choice-btn manual" onclick="showManualLocationSetup()">
                    <div class="choice-icon">🎯</div>
                    <h3>Выбрать вручную</h3>
                    <p>Вы сами укажете страну, регион и город</p>
                </button>
            </div>
        </div>

        <!-- Автоматическое определение локации -->
        <div id="autoLocationDetection" class="screen">
            <div class="header">
                <div class="logo">
                    <div class="neon-icon pulse">🌍</div>
                    <h1>Определяем местоположение</h1>
                    <p>Пожалуйста, подождите...</p>
                </div>
            </div>
            
            <div class="auto-location-container">
                <div class="detection-animation">
                    <div class="radar-container">
                        <div class="radar-circle"></div>
                        <div class="radar-circle delay-1"></div>
                        <div class="radar-circle delay-2"></div>
                        <div class="radar-ping">📍</div>
                    </div>
                    <p class="detection-text">Анализируем ваш IP-адрес...</p>
                </div>
                
                <div class="detection-result" style="display: none;">
                    <!-- Результат будет вставлен через JS -->
                </div>
            </div>
        </div>

        <!-- Выбор локации при первом запуске -->
        <div id="locationSetup" class="screen">
            <div class="header">
                <button class="back-btn" onclick="showMainMenu()" style="display: none;" id="locationBackBtn">← Назад</button>
                <div class="logo">
                    <div class="neon-icon">🌍</div>
                    <h1>Выберите вашу страну</h1>
                    <p>Это поможет находить людей рядом</p>
                </div>
            </div>
            
            <div class="location-setup-container">
                <!-- Кнопка автоопределения -->
                <div class="auto-location-section">
                    <button class="neon-button primary full-width" onclick="autoDetectLocation()">
                        📍 Определить автоматически
                    </button>
                    <p class="or-divider">или выберите вручную</p>
                </div>

                <!-- Выбор страны -->
                <div class="setup-country-selection">
                    <h3>Страна</h3>
                    <div class="country-buttons">
                        <button type="button" class="country-btn setup-country" data-country="russia">
                            <span class="flag">🇷🇺</span>
                            Россия
                        </button>
                        <button type="button" class="country-btn setup-country" data-country="kazakhstan">
                            <span class="flag">🇰🇿</span>
                            Казахстан
                        </button>
                    </div>
                </div>

                <!-- Выбор региона -->
                <div class="setup-region-selection" style="display: none;">
                    <h3>Регион/область</h3>
                    <div class="search-container">
                        <input type="text" class="setup-region-input" placeholder="Начните вводить название...">
                        <div class="suggestions-list setup-region-suggestions"></div>
                    </div>
                </div>

                <!-- Выбор города -->
                <div class="setup-city-selection" style="display: none;">
                    <h3>Город</h3>
                    <div class="search-container">
                        <input type="text" class="setup-city-input" placeholder="Введите название города...">
                        <div class="suggestions-list setup-city-suggestions"></div>
                    </div>
                </div>

                <!-- Отображение выбранной локации -->
                <div class="setup-selected-location" style="display: none;">
                    <div class="location-display">
                        <span class="setup-location-text"></span>
                        <button type="button" class="reset-setup-location">🔄 Изменить</button>
                    </div>
                    <button class="neon-button primary full-width" onclick="saveLocationAndContinue()">
                        ✅ Подтвердить и продолжить
                    </button>
                </div>
            </div>
        </div>

        <!-- Главное меню -->
        <div id="mainMenu" class="screen">
            <div class="header">
                <button class="hamburger-menu" onclick="toggleHamburgerMenu()">
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                </button>
                <div class="logo">
                    <div class="neon-icon">
                        <img src="/webapp/logo.png" alt="Anonimka Logo" style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover; box-shadow: 0 0 20px rgba(236, 72, 153, 0.6);">
                    </div>
                    <h1>Анонимные знакомства</h1>
                    <div class="user-location">
                        <span class="location-info" id="userLocationDisplay"></span>
                    </div>
                </div>
            </div>
            
            <div class="menu-buttons">
                <div style="position: relative; display: inline-block; width: 100%;">
                    <button class="neon-button primary" onclick="showCreateAd()" id="createAdBtn" style="width: 100%;">
                        <span class="icon">📝</span>
                        Создать анкету
                    </button>
                    <span id="adLimitBadge" class="limit-badge" style="display: none;"></span>
                </div>
                <button class="neon-button" onclick="showBrowseAds()">
                    <span class="icon">�️</span>
                    Смотреть анкеты
                </button>
                <button class="neon-button chat-button" onclick="showMyAds()">
                    <span class="icon">📋</span>
                    Мои анкеты
                </button>
                <div style="position: relative; display: inline-block; width: 100%;">
                    <button class="neon-button chat-button" onclick="showMyChats()" style="width: 100%;">
                        <span class="icon">💬</span>
                        Мои чаты
                    </button>
                    <span id="chatBadge" class="chat-badge" style="display: none;"></span>
                </div>
                <button class="neon-button quaternary" onclick="showLocationChoiceScreen()">
                    <span class="icon">📍</span>
                    Сменить город
                </button>
            </div>
        </div>

        <!-- Гамбургер меню -->
        <div id="hamburgerMenuOverlay" class="hamburger-overlay">
            <div class="hamburger-menu-content">
                <div class="hamburger-header">
                    <h2>Меню</h2>
                    <button class="hamburger-close" onclick="closeHamburgerMenu()">×</button>
                </div>
                <nav class="hamburger-nav">
                    <a href="#" class="hamburger-item active" onclick="goToHome()">
                        <span class="hamburger-icon">🏠</span>
                        Главная
                    </a>
                    <a href="#" class="hamburger-item" onclick="showNicknameEditor()">
                        <span class="hamburger-icon">✏️</span>
                        Изменить никнейм
                    </a>
                    <a href="#" class="hamburger-item" onclick="showContacts()">
                        <span class="hamburger-icon">📞</span>
                        Контакты
                    </a>
                    <a href="#" class="hamburger-item" onclick="showRules()">
                        <span class="hamburger-icon">📋</span>
                        Правила использования
                    </a>
                    <a href="#" class="hamburger-item" onclick="showPrivacy()">
                        <span class="hamburger-icon">🔒</span>
                        Политика конфиденциальности
                    </a>
                    <a href="#" class="hamburger-item" onclick="showAbout()">
                        <span class="hamburger-icon">ℹ️</span>
                        О приложении
                    </a>
                    <a href="#" class="hamburger-item logout-item" id="logoutBtn" onclick="handleLogout()" style="display: none;">
                        <span class="hamburger-icon">🚪</span>
                        Выйти из аккаунта
                    </a>
                </nav>
            </div>
        </div>

        <!-- Контакты -->
        <div id="contacts" class="screen info-screen">
            <div class="header">
                <button class="back-btn" onclick="showMainMenu()">← Назад</button>
                <h2>Контакты</h2>
            </div>
            <div class="info-content">
                <div class="contact-item" onclick="showEmailForm()">
                    <span class="contact-icon">📧</span>
                    <div class="contact-details">
                        <h3>Написать письмо</h3>
                        <p>aleksey@vorobey444.ru</p>
                        <span class="contact-action">Нажмите для отправки письма</span>
                    </div>
                </div>
                <div class="contact-item" onclick="openTelegramChat()">
                    <span class="contact-icon">💬</span>
                    <div class="contact-details">
                        <h3>Telegram</h3>
                        <p>@Vorobey_444</p>
                        <span class="contact-action">Нажмите для открытия чата</span>
                    </div>
                </div>
                <div class="contact-item">
                    <span class="contact-icon">⏰</span>
                    <div class="contact-details">
                        <h3>Время работы</h3>
                        <p>Поддержка в рабочие дни</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Форма отправки письма -->
        <div id="emailForm" class="screen">
            <div class="header">
                <button class="back-btn" onclick="showContacts()">← Назад</button>
                <h2>Написать письмо</h2>
            </div>
            
            <div class="email-form-container">
                <form id="contactForm" class="contact-form">
                    <div class="form-group">
                        <label for="senderEmail">Ваша почта для ответа *</label>
                        <input type="email" id="senderEmail" class="neon-input" placeholder="your-email@example.com" required>
                        <span class="input-hint">На эту почту придет ответ</span>
                    </div>
                    
                    <div class="form-group">
                        <label for="emailSubject">Тема письма</label>
                        <input type="text" id="emailSubject" class="neon-input" placeholder="Тема сообщения" value="Обращение через anonimka.online">
                    </div>
                    
                    <div class="form-group">
                        <label for="emailMessage">Сообщение *</label>
                        <textarea id="emailMessage" class="neon-textarea" placeholder="Опишите ваш вопрос или проблему..." rows="8" required></textarea>
                        <span class="input-hint">Минимум 10 символов</span>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="neon-button secondary" onclick="showContacts()">
                            🔙 Отмена
                        </button>
                        <button type="button" class="neon-button primary" id="sendEmailBtn" onclick="handleEmailSubmit(event)">
                            📧 Отправить письмо
                        </button>
                    </div>
                </form>
                
                <div id="emailStatus" class="email-status" style="display: none;">
                    <!-- Статус отправки будет показан здесь -->
                </div>
            </div>
        </div>

        <!-- Правила использования -->
        <div id="rules" class="screen info-screen">
            <div class="header">
                <button class="back-btn" onclick="showMainMenu()">← Назад</button>
                <h2>Правила использования</h2>
            </div>
            <div class="info-content">
                <div class="rules-section">
                    <h3>🚫 Запрещено</h3>
                    <ul>
                        <li>Размещение незаконного контента</li>
                        <li>Спам и многократное дублирование</li>
                        <li>Продажа запрещенных товаров</li>
                        <li>Мошенничество и обман</li>
                        <li>Нарушение приватности других людей</li>
                    </ul>
                </div>
                <div class="rules-section">
                    <h3>✅ Разрешено</h3>
                    <ul>
                        <li>Анонимные знакомства</li>
                        <li>Поиск друзей и общения</li>
                        <li>Размещение честных анкет</li>
                        <li>Соблюдение взаимного уважения</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Политика конфиденциальности -->
        <div id="privacy" class="screen info-screen">
            <div class="header">
                <button class="back-btn" onclick="showMainMenu()">← Назад</button>
                <h2>Политика конфиденциальности</h2>
            </div>
            <div class="info-content">
                <div class="privacy-section">
                    <h3>🔒 Защита данных</h3>
                    <p>Мы обеспечиваем полную анонимность пользователей. Никакие персональные данные не сохраняются на наших серверах.</p>
                </div>
                <div class="privacy-section">
                    <h3>📊 Сбор информации</h3>
                    <p>Собираем только необходимую техническую информацию для работы приложения: геолокацию по IP-адресу для показа релевантных анкет.</p>
                </div>
                <div class="privacy-section">
                    <h3>🛡️ Безопасность</h3>
                    <p>Все данные передаются по защищенному соединению и автоматически удаляются через 30 дней.</p>
                </div>
            </div>
        </div>

        <!-- О приложении -->
        <div id="about" class="screen info-screen">
            <div class="header">
                <button class="back-btn" onclick="showMainMenu()">← Назад</button>
                <h2>О приложении</h2>
            </div>
            <div class="info-content">
                <div class="about-section">
                    <div class="app-logo">
                        <img src="/webapp/logo.png" alt="Logo" class="logo-image">
                        <h3>Анонимные знакомства</h3>
                        <p class="version">Версия 3.0</p>
                    </div>
                </div>
                <div class="about-section">
                    <h3>🎯 Миссия</h3>
                    <p>Создать безопасное пространство для анонимного общения и знакомств без страха осуждения.</p>
                </div>
                <div class="about-section">
                    <h3>⚡ Особенности</h3>
                    <ul>
                        <li>Полная анонимность</li>
                        <li>Автоматическое определение местоположения</li>
                        <li>Киберпанк дизайн</li>
                        <li>Безопасные чаты</li>
                    </ul>
                </div>
                <div class="about-section">
                    <p class="copyright">© 2025 Anonimka.kz. Все права защищены.</p>
                </div>
            </div>
        </div>

        <!-- Редактирование никнейма -->
        <div id="nicknameEditScreen" class="screen info-screen">
            <div class="header">
                <button class="back-btn" onclick="closeHamburgerAndGoHome()">← Назад</button>
                <h2>✏️ Изменить никнейм</h2>
            </div>
            <div class="info-content">
                <div class="nickname-edit-section">
                    <div class="nickname-current">
                        <h3>Текущий никнейм</h3>
                        <div class="current-nickname-display">
                            <span class="nickname-icon-large">🎭</span>
                            <span class="nickname-text" id="currentNicknameDisplay">Аноним</span>
                        </div>
                    </div>
                    
                    <div class="nickname-edit-form">
                        <h3>Новый никнейм</h3>
                        <p class="nickname-hint-page">Выберите, как вас будут видеть в анкетиях</p>
                        <div class="nickname-input-wrapper-page">
                            <input type="text" 
                                   id="nicknameInputPage" 
                                   class="neon-input" 
                                   placeholder="Введите новый никнейм" 
                                   maxlength="30">
                            <span class="input-icon">🎭</span>
                        </div>
                        
                        <div class="nickname-suggestions-page">
                            <p class="suggestion-label">Или используйте:</p>
                            <button type="button" class="suggestion-btn-page" onclick="useDefaultNicknamePage()">
                                <span id="defaultNicknameTextPage">Использовать имя из Telegram</span>
                            </button>
                            <button type="button" class="suggestion-btn-page reset-btn" onclick="resetToAnonym()">
                                <span>🎭 Вернуть "Аноним"</span>
                            </button>
                        </div>
                        
                        <button class="neon-button primary full-width" onclick="saveNicknamePage()">
                            ✅ Сохранить никнейм
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Создание анкетия -->
        <div id="createAd" class="screen">
            <div class="header">
                <button class="back-btn" onclick="showMainMenu()">← Назад</button>
                <h2>Создать анкетие</h2>
            </div>
            
            <form id="adForm" class="form-container">
                <div class="form-step active" id="step1">
                    <h3>👤 Ваш пол</h3>
                    <div class="current-location">
                        <p>📍 Ваш город: <span id="formLocationDisplay"></span></p>
                        <button type="button" class="change-location-btn" onclick="showLocationSetup()">
                            📍 Сменить город
                        </button>
                    </div>
                    <div class="gender-select">
                        <button type="button" class="gender-btn" data-gender="Мужчина">
                            <span class="icon">👨</span>
                            Мужчина
                        </button>
                        <button type="button" class="gender-btn" data-gender="Женщина">
                            <span class="icon">👩</span>
                            Женщина
                        </button>
                    </div>
                </div>

                <div class="form-step" id="step2">
                    <h3>🔍 Кого ищете</h3>
                    <div class="target-select">
                        <button type="button" class="target-btn" data-target="Мужчину">👨 Мужчину</button>
                        <button type="button" class="target-btn" data-target="Женщину">👩 Женщину</button>
                        <button type="button" class="target-btn" data-target="Пару">👫 Пару</button>
                    </div>
                </div>

                <div class="form-step" id="step3">
                    <h3>🎯 Цель знакомства</h3>
                    <div class="goal-select">
                        <button type="button" class="goal-btn" data-goal="Дружба">🤝 Дружба</button>
                        <button type="button" class="goal-btn" data-goal="Путешествия">✈️ Путешествия</button>
                        <button type="button" class="goal-btn" data-goal="Общение">💬 Общение</button>
                        <button type="button" class="goal-btn" data-goal="Секс">🔥 Секс</button>
                        <button type="button" class="goal-btn" data-goal="Другое">❓ Другое</button>
                    </div>
                </div>

                <div class="form-step" id="step4">
                    <h3>📅 Возраст партнера</h3>
                    <div class="age-range">
                        <div class="input-group">
                            <label>От</label>
                            <div class="age-control">
                                <button type="button" class="age-btn minus" onclick="decreaseAge('ageFrom')">−</button>
                                <input type="number" id="ageFrom" min="18" max="100" class="neon-input small" placeholder="18" onchange="validateAgeRange()">
                                <button type="button" class="age-btn plus" onclick="increaseAge('ageFrom')">+</button>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>До</label>
                            <div class="age-control">
                                <button type="button" class="age-btn minus" onclick="decreaseAge('ageTo')">−</button>
                                <input type="number" id="ageTo" min="18" max="100" class="neon-input small" placeholder="18" onchange="validateAgeRange()">
                                <button type="button" class="age-btn plus" onclick="increaseAge('ageTo')">+</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-step" id="step5">
                    <h3>🎂 Ваш возраст</h3>
                    <div class="age-control centered">
                        <button type="button" class="age-btn minus" onclick="decreaseAge('myAge')">−</button>
                        <input type="number" id="myAge" min="18" max="100" class="neon-input" placeholder="Введите ваш возраст">
                        <button type="button" class="age-btn plus" onclick="increaseAge('myAge')">+</button>
                    </div>
                </div>

                <div class="form-step" id="step6">
                    <h3>💪 Телосложение</h3>
                    <div class="body-select">
                        <button type="button" class="body-btn" data-body="Стройное">✨ Стройное</button>
                        <button type="button" class="body-btn" data-body="Обычное">👤 Обычное</button>
                        <button type="button" class="body-btn" data-body="Плотное">💪 Плотное</button>
                        <button type="button" class="body-btn" data-body="Спортивное">🏋️ Спортивное</button>
                        <button type="button" class="body-btn" data-body="Другое">❓ Другое</button>
                    </div>
                </div>

                <div class="form-step" id="step7">
                    <h3>💬 Текст анкетия</h3>
                </div>
            </form>

            <!-- Textarea вынесен отдельно для обхода проблем с display -->
            <div id="textareaContainer" style="display: none; text-align: center; padding: 0 20px;">
                <textarea 
                    id="adText" 
                    placeholder="Расскажите о себе и что ищете..." 
                    rows="6"
                    style="
                        width: 100%;
                        max-width: 500px;
                        padding: 15px;
                        background: rgba(26, 26, 46, 0.8);
                        border: 2px solid #ff00ff;
                        border-radius: 15px;
                        color: #e0e0ff;
                        font-size: 16px;
                        resize: vertical;
                        min-height: 120px;
                        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                        box-sizing: border-box;
                        display: block !important;
                        visibility: visible !important;
                        opacity: 1 !important;
                    "
                ></textarea>
            </div>

            <div class="form-navigation">
                <button id="prevBtn" class="nav-btn" onclick="previousStep()" style="display: none;">← Назад</button>
                <button id="nextBtn" class="nav-btn primary" onclick="nextStep()">Далее →</button>
                <button id="submitBtn" class="nav-btn success" onclick="submitAd()" style="display: none;">🚀 Опубликовать</button>
            </div>
        </div>

        <!-- Просмотр анкет -->
        <div id="browseAds" class="screen">
            <div class="header">
                <button class="back-btn" onclick="showMainMenu()">← Назад</button>
                <h2>анкетия</h2>
            </div>
            
            <div class="current-location-display">
                <p class="location-label"> Ваша локация:</p>
                <p class="location-value" id="browseLocationDisplay">Загрузка...</p>
                <button class="neon-button small" onclick="showLocationSetup()">
                     Сменить локацию
                </button>
            </div>

            <div id="adsList" class="ads-list">
                <!-- анкетия будут загружены через JS -->
            </div>
        </div>

        <!-- Мои анкетия -->
        <div id="myAds" class="screen">
            <div class="header">
                <button class="back-btn" onclick="showMainMenu()">← Назад</button>
                <h2>Мои анкетия</h2>
            </div>

            <div id="myAdsList" class="ads-list">
                <!-- анкетия пользователя будут загружены через JS -->
            </div>
        </div>

        <!-- Мои чаты -->
        <div id="myChats" class="screen">
            <div class="header">
                <button class="back-btn" onclick="showMainMenu()">← Назад</button>
                <h2>💬 Мои чаты</h2>
            </div>

            <!-- Вкладки -->
            <div class="tabs-container">
                <button class="tab-btn active" onclick="switchChatTab('active')">
                    <span class="tab-icon">✅</span>
                    <span class="tab-label">Открытые чаты</span>
                    <span class="tab-badge" id="activeChatsCount">0</span>
                </button>
                <button class="tab-btn" onclick="switchChatTab('requests')">
                    <span class="tab-icon">📨</span>
                    <span class="tab-label">Запросы</span>
                    <span class="tab-badge" id="requestsCount">0</span>
                </button>
            </div>

            <div class="chats-container">
                <!-- Вкладка: Открытые чаты -->
                <div id="activeChatsTab" class="tab-content active">
                    <div id="activeChats" class="chats-list">
                        <!-- Открытые чаты будут загружены через JS -->
                        <div class="loading-placeholder">
                            <div class="neon-icon pulse">💬</div>
                            <p>Загрузка чатов...</p>
                        </div>
                    </div>
                </div>

                <!-- Вкладка: Запросы -->
                <div id="requestsTab" class="tab-content">
                    <div id="chatRequests" class="chats-list">
                        <!-- Запросы на чаты будут загружены через JS -->
                        <div class="loading-placeholder">
                            <div class="neon-icon pulse">📨</div>
                            <p>Загрузка запросов...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Экран открытого чата -->
        <div id="chatView" class="screen">
            <div class="header chat-header">
                <button class="back-btn" onclick="showMyChats()">← Назад</button>
                <div class="chat-info">
                    <h2 id="chatTitle">Анонимный чат</h2>
                    <p id="chatAdId" class="chat-subtitle"></p>
                </div>
            </div>

            <div class="chat-messages-container">
                <div id="chatMessages" class="chat-messages">
                    <!-- Сообщения будут загружены через JS -->
                </div>
            </div>

            <div class="chat-input-container">
                <input type="file" id="photoInput" accept="image/*" style="display: none;" onchange="handlePhotoSelect(event)" />
                <button class="attach-photo-button" onclick="document.getElementById('photoInput').click()" title="Прикрепить фото">
                    <span>📷</span>
                </button>
                <div id="photoPreview" class="photo-preview" style="display: none;">
                    <img id="photoPreviewImage" src="" alt="Preview" />
                    <button class="remove-photo-button" onclick="removePhoto()">×</button>
                </div>
                <input type="text" id="messageInput" class="chat-input" placeholder="Введите сообщение..." />
                <button class="send-button" onclick="sendMessage()">
                    <span>📤</span>
                </button>
            </div>
        </div>

        <!-- Детали анкетия -->
        <div id="adDetails" class="screen">
            <div class="header">
                <button class="back-btn" onclick="showBrowseAds()">← К анкетиям</button>
            </div>
            
            <div id="adContent" class="ad-details">
                <!-- Контент анкетия -->
            </div>
            
            <div class="ad-details-footer">
                <button class="neon-button primary full-width" onclick="contactAuthor()">
                    ✉️ Написать автору
                </button>
            </div>
        </div>
    </div>

    <!-- Модальное окно авторизации через Telegram -->
    <div id="telegramAuthModal" class="modal" style="display: none;">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>🔐 Авторизация через Telegram</h2>
                <button class="modal-close" onclick="closeTelegramAuthModal()">✕</button>
            </div>
            <div class="modal-body">
                <div class="auth-warning">
                    <div class="warning-icon">⚠️</div>
                    <h3>Требуется авторизация</h3>
                    <p>Для продолжения использования сайта необходимо авторизоваться через Telegram.</p>
                    <p>Это позволит:</p>
                    <ul>
                        <li>✅ Создавать анкетия</li>
                        <li>✅ Получать уведомления о сообщениях</li>
                        <li>✅ Создавать приватные чаты</li>
                    </ul>
                </div>
                
                <div class="telegram-login-container">
                    <h4>� Отсканируйте QR-код</h4>
                    <p class="qr-instruction">
                        1. Откройте камеру в мобильном приложении Telegram<br>
                        2. Наведите на QR-код ниже<br>
                        3. Нажмите "Открыть сайт" в боте<br>
                        4. Авторизация завершится автоматически!
                    </p>
                    
                    <div class="qr-code-wrapper">
                        <div id="qrcode"></div>
                        <div class="qr-loading" id="qrLoading">
                            <div class="spinner"></div>
                            <p>Генерация QR-кода...</p>
                        </div>
                    </div>
                    
                    <div class="or-divider">
                        <span>или</span>
                    </div>
                    
                    <script async src="https://telegram.org/js/telegram-widget.js?22" data-telegram-login="anonimka_bot" data-size="large" data-radius="8" data-onauth="onTelegramAuth(user)" data-request-access="write"></script>
                    <p class="login-hint">Нажмите кнопку для входа через браузер</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно Premium тарифов -->
    <div id="premiumModal" class="modal" style="display: none;">
        <div class="modal-content premium-modal">
            <div class="modal-header">
                <h2>⭐ Выберите тариф</h2>
                <button class="modal-close" onclick="closePremiumModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="pricing-table">
                    <!-- FREE план -->
                    <div class="pricing-card">
                        <div class="pricing-header">
                            <h3>FREE</h3>
                            <div class="pricing-price">
                                <span class="price-amount">0</span>
                                <span class="price-currency">₸</span>
                            </div>
                            <p class="price-period">бесплатно</p>
                        </div>
                        <div class="pricing-features">
                            <div class="feature-item">
                                <span class="feature-icon">📢</span>
                                <span class="feature-text">1 активное анкетие в день</span>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon">📸</span>
                                <span class="feature-text">5 фото в день</span>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon">📌</span>
                                <span class="feature-text">Закрепление: 1 час раз в 3 дня</span>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon">💬</span>
                                <span class="feature-text">Базовые функции</span>
                            </div>
                        </div>
                        <button class="pricing-btn" onclick="selectPlan('free')" disabled>
                            Текущий план
                        </button>
                    </div>

                    <!-- PRO план -->
                    <div class="pricing-card featured">
                        <div class="premium-badge">⭐ ПОПУЛЯРНО</div>
                        <div class="pricing-header">
                            <h3>PRO</h3>
                            <div class="pricing-price">
                                <span class="price-amount" id="proPriceAmount">499</span>
                                <span class="price-currency" id="proPriceCurrency">₸</span>
                            </div>
                            <p class="price-period">в месяц</p>
                        </div>
                        <div class="pricing-features">
                            <div class="feature-item">
                                <span class="feature-icon">📢</span>
                                <span class="feature-text">До 3 анкет в день</span>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon">📸</span>
                                <span class="feature-text">Безлимит фото</span>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon">📌</span>
                                <span class="feature-text">Закрепление: 3 раза в день по 1 часу</span>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon">⭐</span>
                                <span class="feature-text">Значок PRO в запросах</span>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon">🎯</span>
                                <span class="feature-text">Приоритетная поддержка</span>
                            </div>
                        </div>
                        <button class="pricing-btn premium" onclick="activatePremium()" id="activatePremiumBtn">
                            Оформить PRO
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно для просмотра анкетия -->
    <div id="adModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>🔍 Просмотр анкетия</h2>
                <button class="modal-close" onclick="closeAdModal()">×</button>
            </div>
            <div class="modal-body" id="adModalBody">
                <div class="loading-spinner">
                    <div class="spinner"></div>
                    <p>Загрузка анкетия...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно для просмотра фото -->
    <div id="photoModal" class="photo-modal" style="display: none;" onclick="closePhotoModal()">
        <div class="photo-modal-content">
            <button class="photo-modal-close" onclick="closePhotoModal()">×</button>
            <img id="photoModalImage" src="" alt="Фото" />
        </div>
    </div>

    <script src="/webapp/email-service.js?v=1.0"></script>
    <script>
        // Принудительная очистка кеша
        const timestamp = Date.now();
        const script = document.createElement('script');
        script.src = `/webapp/app.js?v=${timestamp}`;
        document.body.appendChild(script);
    </script>
</body>
</html>



