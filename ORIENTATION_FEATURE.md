# Добавление поля "Ориентация" в анкеты

## Что сделано

### 1. База данных (Neon PostgreSQL)
Создан SQL-файл миграции: `neon_add_orientation.sql`

**Чтобы применить миграцию:**
1. Откройте Neon Dashboard: https://console.neon.tech
2. Выберите свой проект
3. Перейдите в SQL Editor
4. Скопируйте и выполните содержимое файла `neon_add_orientation.sql`:

```sql
ALTER TABLE ads ADD COLUMN IF NOT EXISTS orientation TEXT;
CREATE INDEX IF NOT EXISTS idx_ads_orientation ON ads(orientation);
```

Допустимые значения (enforced на уровне приложения):
- `hetero` — Гетеро
- `gay` — Гей / Лесбиянка  
- `bi` — Би
- `pan` — Пансексуал
- `ace` — Асексуал
- `demi` — Демисексуал
- `queer` — Квир
- `grey` — Грейсексуал
- `sever` — Север

### 2. Backend (API)
- Обновлён `/api/ads` (POST):
  - Принимает поле `orientation` из фронтенда
  - Сохраняет в БД при создании анкеты
- Обновлён `/api/ads` (GET):
  - Возвращает поле `orientation` для всех анкет

### 3. Frontend (WebApp)
#### Добавлен новый шаг в форму создания анкеты:
- **Step 7** — выбор ориентации (между телосложением и текстом)
- Вертикальное расположение кнопок
- Каждая кнопка содержит:
  - Эмодзи слева
  - Название и остроумное описание в центре
  - Информационный значок ℹ️ справа (с tooltip)

#### Обновлено отображение анкет:
- Детальный просмотр (модальное окно): показывает ориентацию под телосложением
- Список "Мои анкеты": показывает ориентацию между телосложением и целью
- Используются красивые лейблы с эмодзи

#### Стилизация:
- Добавлены CSS-классы `.orientation-select`, `.orientation-btn`, `.orientation-content`, `.orientation-text`, `.info-icon`
- Hover эффекты для кнопок и иконки
- Цветовое выделение выбранной ориентации

### 4. Validation & Logic
- Обновлена валидация: шаг 7 требует выбора ориентации
- Обновлено `totalSteps = 8` (было 7)
- Добавлена функция `selectOrientation(orientation)` для выбора
- Обновлён `submitAd()` — отправляет `orientation` в API

## Тестирование

1. **Создание новой анкеты:**
   - Пройдите все шаги
   - На шаге 7 выберите ориентацию (должна подсветиться)
   - Завершите создание
   - Анкета должна сохраниться с полем orientation

2. **Просмотр анкет:**
   - Откройте список анкет
   - Откройте детали анкеты (модальное окно)
   - Должна отображаться строка с ориентацией

3. **Мои анкеты:**
   - Перейдите в "Мои объявления"
   - Анкеты с ориентацией должны отображать её в списке

## Откат (при необходимости)

Если нужно удалить колонку:
```sql
ALTER TABLE ads DROP COLUMN IF EXISTS orientation;
DROP INDEX IF EXISTS idx_ads_orientation;
```

## Коммит и деплой

```bash
cd "e:/my project/app chat/anonimka-nextjs"
git add .
git commit -m "feat: add orientation field to user profiles"
git push
vercel --prod
```

После деплоя не забудьте применить SQL-миграцию в Neon!
